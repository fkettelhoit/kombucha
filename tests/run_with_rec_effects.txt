('acc => {
    __handle({
        effect!(Foo)
    }, effect!, 'r => { 'x => {
        r(acc(x))
    } })
})(List)

((=>
  'acc
  { (__handle
      { (effect!
          Foo) }
      effect!
      (=>
        'r
        { (=>
            'x
            { (r
                (acc
                  x)) }) })) })
  List)

( ( ( =>
        =>
          0
      "acc" )
    =>
      ( ( ( =>
              =>
                =>
                  ( try
                    2
                    1
                    0 )
            =>
              ( effect!
                Foo ) )
          effect! )
        ( ( =>
              =>
                0
            "r" )
          =>
            ( ( =>
                  =>
                    0
                "x" )
              =>
                ( 1
                  ( 2
                    0 ) ) ) ) ) )
  List )

00000: LoadFn { code: 00002, fvars: 00001 }
00001:   Return
00002: LoadVar(00000)
00003: LoadVar(00001)
00004: LoadFn { code: 00000, fvars: 00000 }
00005: ApplyArgToFn
00006: LoadVar(00001)
00007: ApplyArgToFn
00008: ApplyArgToFn
00009:   Return
00010: LoadVar(00000)
00011: LoadVar(00002)
00012: ApplyArgToFn
00013: LoadVar(00001)
00014: ApplyArgToFn
00015:   Return
00016: LoadVar(00000)
00017:   Return
00018: LoadFn { code: 00016, fvars: 00000 }
00019:   Return
00020: LoadFn { code: 00010, fvars: 00002 }
00021: PushString(""x"")
00022: LoadFn { code: 00018, fvars: 00000 }
00023: ApplyArgToFn
00024: ApplyArgToFn
00025:   Return
00026: LoadVar(00000)
00027:   Return
00028: LoadFn { code: 00026, fvars: 00000 }
00029:   Return
00030: PushString("Foo")
00031: PushEffect("effect")
00032: ApplyArgToFn
00033:   Return
00034: LoadVar(00002)
00035: LoadVar(00001)
00036: LoadVar(00000)
00037: Try
00038: ApplyArgToFn
00039: Unwind
00040: ApplyArgToFn
00041: ApplyArgToFn
00042:   Return
00043: LoadFn { code: 00034, fvars: 00002 }
00044:   Return
00045: LoadFn { code: 00043, fvars: 00001 }
00046:   Return
00047: LoadFn { code: 00020, fvars: 00001 }
00048: PushString(""r"")
00049: LoadFn { code: 00028, fvars: 00000 }
00050: ApplyArgToFn
00051: ApplyArgToFn
00052: PushEffect("effect")
00053: LoadFn { code: 00030, fvars: 00000 }
00054: LoadFn { code: 00045, fvars: 00000 }
00055: ApplyArgToFn
00056: ApplyArgToFn
00057: ApplyArgToFn
00058:   Return
00059: LoadVar(00000)
00060:   Return
00061: LoadFn { code: 00059, fvars: 00000 }
00062:   Return
00063: PushString("List")
00064: LoadFn { code: 00047, fvars: 00000 }
00065: PushString(""acc"")
00066: LoadFn { code: 00061, fvars: 00000 }
00067: ApplyArgToFn
00068: ApplyArgToFn
00069: ApplyArgToFn

List(Foo)

---

'with-toggle = ('loop ~> {
    'val => { 'r => {
        __handle({
            r(val)
        }, toggle!, 'r => { ' => {
            __compare(val, True, {
              loop(False, r)
            }, {
              loop(True, r)
            })
        }})
    }}
})
with-toggle(False, { List(toggle!(), toggle!(), toggle!()) })

(=
  'with-toggle
  (~>
    'loop
    { (=>
        'val
        { (=>
            'r
            { (__handle
                { (r
                    val) }
                toggle!
                (=>
                  'r
                  { (=>
                      '
                      { (__compare
                          val
                          True
                          { (loop
                              False
                              r) }
                          { (loop
                              True
                              r) }) }) })) }) }) }))
(with-toggle
  False
  { (List
      (toggle!)
      (toggle!)
      (toggle!)) })

( ( ( =>
        =>
          =>
            ( 0
              1 )
      "with-toggle" )
    ( ( =>
          =>
            ~>
              0
        "loop" )
      =>
        ( ( =>
              =>
                0
            "val" )
          =>
            ( ( =>
                  =>
                    0
                "r" )
              =>
                ( ( ( =>
                        =>
                          =>
                            ( try
                              2
                              1
                              0 )
                      =>
                        ( 1
                          2 ) )
                    toggle! )
                  ( ( =>
                        =>
                          0
                      "r" )
                    =>
                      ( ( =>
                            =>
                              0
                          "" )
                        =>
                          ( ( ( ( =>
                                    =>
                                      =>
                                        =>
                                          ( if
                                            3
                                            2
                                            1
                                            0 )
                                  3 )
                                True )
                              =>
                                ( ( 5
                                    False )
                                  2 ) )
                            =>
                              ( ( 5
                                  True )
                                2 ) ) ) ) ) ) ) ) )
  =>
    ( ( 0
        ( Value
          False ) )
      =>
        ( ( ( List
              ( toggle!
                [] ) )
            ( toggle!
              [] ) )
          ( toggle!
            [] ) ) ) )

00000: LoadFn { code: 00002, fvars: 00001 }
00001:   Return
00002: LoadVar(00000)
00003: LoadVar(00001)
00004: LoadFn { code: 00000, fvars: 00000 }
00005: ApplyArgToFn
00006: LoadVar(00001)
00007: ApplyArgToFn
00008: ApplyArgToFn
00009:   Return
00010: PushString("True")
00011: LoadVar(00005)
00012: ApplyArgToFn
00013: LoadVar(00002)
00014: ApplyFnToArg
00015:   Return
00016: PushString("False")
00017: LoadVar(00005)
00018: ApplyArgToFn
00019: LoadVar(00002)
00020: ApplyFnToArg
00021:   Return
00022: LoadVar(00003)
00023: LoadVar(00002)
00024: LoadVar(00001)
00025: LoadVar(00000)
00026: Cmp
00027: ApplyArgToFn
00028:   Return
00029: LoadFn { code: 00022, fvars: 00003 }
00030:   Return
00031: LoadFn { code: 00029, fvars: 00002 }
00032:   Return
00033: LoadFn { code: 00031, fvars: 00001 }
00034:   Return
00035: LoadFn { code: 00010, fvars: 00005 }
00036: LoadFn { code: 00016, fvars: 00005 }
00037: PushString("True")
00038: LoadVar(00003)
00039: LoadFn { code: 00033, fvars: 00000 }
00040: ApplyArgToFn
00041: ApplyArgToFn
00042: ApplyArgToFn
00043: ApplyArgToFn
00044:   Return
00045: LoadVar(00000)
00046:   Return
00047: LoadFn { code: 00045, fvars: 00000 }
00048:   Return
00049: LoadFn { code: 00035, fvars: 00004 }
00050: PushString("""")
00051: LoadFn { code: 00047, fvars: 00000 }
00052: ApplyArgToFn
00053: ApplyArgToFn
00054:   Return
00055: LoadVar(00000)
00056:   Return
00057: LoadFn { code: 00055, fvars: 00000 }
00058:   Return
00059: LoadVar(00002)
00060: LoadVar(00001)
00061: ApplyArgToFn
00062:   Return
00063: LoadVar(00002)
00064: LoadVar(00001)
00065: LoadVar(00000)
00066: Try
00067: ApplyArgToFn
00068: Unwind
00069: ApplyArgToFn
00070: ApplyArgToFn
00071:   Return
00072: LoadFn { code: 00063, fvars: 00002 }
00073:   Return
00074: LoadFn { code: 00072, fvars: 00001 }
00075:   Return
00076: LoadFn { code: 00049, fvars: 00003 }
00077: PushString(""r"")
00078: LoadFn { code: 00057, fvars: 00000 }
00079: ApplyArgToFn
00080: ApplyArgToFn
00081: PushEffect("toggle")
00082: LoadFn { code: 00059, fvars: 00002 }
00083: LoadFn { code: 00074, fvars: 00000 }
00084: ApplyArgToFn
00085: ApplyArgToFn
00086: ApplyArgToFn
00087:   Return
00088: LoadVar(00000)
00089:   Return
00090: LoadFn { code: 00088, fvars: 00000 }
00091:   Return
00092: LoadFn { code: 00076, fvars: 00002 }
00093: PushString(""r"")
00094: LoadFn { code: 00090, fvars: 00000 }
00095: ApplyArgToFn
00096: ApplyArgToFn
00097:   Return
00098: LoadVar(00000)
00099:   Return
00100: LoadFn { code: 00098, fvars: 00000 }
00101:   Return
00102: LoadFn { code: 00092, fvars: 00001 }
00103: PushString(""val"")
00104: LoadFn { code: 00100, fvars: 00000 }
00105: ApplyArgToFn
00106: ApplyArgToFn
00107:   Return
00108: LoadVar(00000)
00109: LoadFn { code: 00000, fvars: 00000 }
00110: ApplyArgToFn
00111:   Return
00112: LoadFn { code: 00108, fvars: 00000 }
00113:   Return
00114: LoadVar(00001)
00115: LoadVar(00000)
00116: ApplyArgToFn
00117:   Return
00118: LoadFn { code: 00114, fvars: 00001 }
00119:   Return
00120: LoadFn { code: 00118, fvars: 00000 }
00121:   Return
00122: PushString("")
00123: PushEffect("toggle")
00124: ApplyArgToFn
00125: PushString("List")
00126: ApplyArgToFn
00127: PushString("")
00128: PushEffect("toggle")
00129: ApplyArgToFn
00130: ApplyFnToArg
00131: PushString("")
00132: PushEffect("toggle")
00133: ApplyArgToFn
00134: ApplyFnToArg
00135:   Return
00136: PushString("False")
00137: PushString("Value")
00138: ApplyArgToFn
00139: LoadVar(00000)
00140: ApplyArgToFn
00141: LoadFn { code: 00122, fvars: 00000 }
00142: ApplyFnToArg
00143:   Return
00144: LoadFn { code: 00102, fvars: 00000 }
00145: PushString(""loop"")
00146: LoadFn { code: 00112, fvars: 00000 }
00147: ApplyArgToFn
00148: ApplyArgToFn
00149: PushString(""with-toggle"")
00150: LoadFn { code: 00120, fvars: 00000 }
00151: ApplyArgToFn
00152: ApplyArgToFn
00153: LoadFn { code: 00136, fvars: 00000 }
00154: ApplyFnToArg

List(True, False, True)