('acc => {
    __handle({
        effect!(Foo)
    }, effect!, 'r => { 'x => {
        r(acc(x))
    } })
})(List)

((=>
  'acc
  { (__handle
      { (effect!
          Foo) }
      effect!
      (=>
        'r
        { (=>
            'x
            { (r
                (acc
                  x)) }) })) })
  List)

( ( ( =>
        =>
          0
      "acc" )
    =>
      ( ( ( =>
              =>
                =>
                  ( try
                    2
                    1
                    0 )
            =>
              ( effect!
                Foo ) )
          effect! )
        ( ( =>
              =>
                0
            "r" )
          =>
            ( ( =>
                  =>
                    0
                "x" )
              =>
                ( 1
                  ( 2
                    0 ) ) ) ) ) )
  List )

00000: LoadClosure { code: 00002, fvars: 00001 }
00001:   Return
00002: LoadVar(00001)
00003: LoadFn(00000)
00004: LoadVar(00001)
00005: ApplyFnToArg
00006: ApplyFnToArg
00007: LoadVar(00000)
00008: ApplyFnToArg
00009:   Return
00010: LoadVar(00000)
00011:   Return
00012: LoadFn(00010)
00013:   Return
00014: LoadVar(00002)
00015: LoadVar(00001)
00016: LoadVar(00000)
00017: Try
00018: ApplyArgToFn
00019: Unwind
00020: ApplyArgToFn
00021: ApplyArgToFn
00022:   Return
00023: LoadClosure { code: 00014, fvars: 00002 }
00024:   Return
00025: LoadClosure { code: 00023, fvars: 00001 }
00026:   Return
00027: PushEffect("effect")
00028: PushString("Foo")
00029: ApplyFnToArg
00030:   Return
00031: LoadVar(00000)
00032:   Return
00033: LoadFn(00031)
00034:   Return
00035: LoadVar(00000)
00036:   Return
00037: LoadFn(00035)
00038:   Return
00039: LoadVar(00001)
00040: LoadVar(00002)
00041: LoadVar(00000)
00042: ApplyFnToArg
00043: ApplyFnToArg
00044:   Return
00045: LoadFn(00037)
00046: PushString(""x"")
00047: ApplyFnToArg
00048: LoadClosure { code: 00039, fvars: 00002 }
00049: ApplyFnToArg
00050:   Return
00051: LoadFn(00025)
00052: LoadFn(00027)
00053: ApplyFnToArg
00054: PushEffect("effect")
00055: ApplyFnToArg
00056: LoadFn(00033)
00057: PushString(""r"")
00058: ApplyFnToArg
00059: LoadClosure { code: 00045, fvars: 00001 }
00060: ApplyFnToArg
00061: ApplyFnToArg
00062:   Return
00063: LoadFn(00012)
00064: PushString(""acc"")
00065: ApplyFnToArg
00066: LoadFn(00051)
00067: ApplyFnToArg
00068: PushString("List")
00069: ApplyFnToArg

List(Foo)

---

'with-toggle = ('loop ~> {
    'val => { 'r => {
        __handle({
            r(val)
        }, toggle!, 'r => { ' => {
            __compare(val, True, {
              loop(False, r)
            }, {
              loop(True, r)
            })
        }})
    }}
})
with-toggle(False, { List(toggle!(), toggle!(), toggle!()) })

(=
  'with-toggle
  (~>
    'loop
    { (=>
        'val
        { (=>
            'r
            { (__handle
                { (r
                    val) }
                toggle!
                (=>
                  'r
                  { (=>
                      '
                      { (__compare
                          val
                          True
                          { (loop
                              False
                              r) }
                          { (loop
                              True
                              r) }) }) })) }) }) }))
(with-toggle
  False
  { (List
      (toggle!)
      (toggle!)
      (toggle!)) })

( ( ( =>
        =>
          =>
            ( 0
              1 )
      "with-toggle" )
    ( ( =>
          =>
            ~>
              0
        "loop" )
      =>
        ( ( =>
              =>
                0
            "val" )
          =>
            ( ( =>
                  =>
                    0
                "r" )
              =>
                ( ( ( =>
                        =>
                          =>
                            ( try
                              2
                              1
                              0 )
                      =>
                        ( 1
                          2 ) )
                    toggle! )
                  ( ( =>
                        =>
                          0
                      "r" )
                    =>
                      ( ( =>
                            =>
                              0
                          "" )
                        =>
                          ( ( ( ( =>
                                    =>
                                      =>
                                        =>
                                          ( if
                                            3
                                            2
                                            1
                                            0 )
                                  3 )
                                True )
                              =>
                                ( ( 5
                                    False )
                                  2 ) )
                            =>
                              ( ( 5
                                  True )
                                2 ) ) ) ) ) ) ) ) )
  =>
    ( ( 0
        ( Value
          False ) )
      =>
        ( ( ( List
              ( toggle!
                [] ) )
            ( toggle!
              [] ) )
          ( toggle!
            [] ) ) ) )

00000: LoadClosure { code: 00002, fvars: 00001 }
00001:   Return
00002: LoadVar(00001)
00003: LoadFn(00000)
00004: LoadVar(00001)
00005: ApplyFnToArg
00006: ApplyFnToArg
00007: LoadVar(00000)
00008: ApplyFnToArg
00009:   Return
00010: LoadVar(00000)
00011: LoadVar(00001)
00012: ApplyFnToArg
00013:   Return
00014: LoadClosure { code: 00010, fvars: 00001 }
00015:   Return
00016: LoadFn(00014)
00017:   Return
00018: LoadVar(00000)
00019: LoadFn(00000)
00020: ApplyArgToFn
00021:   Return
00022: LoadFn(00018)
00023:   Return
00024: LoadVar(00000)
00025:   Return
00026: LoadFn(00024)
00027:   Return
00028: LoadVar(00000)
00029:   Return
00030: LoadFn(00028)
00031:   Return
00032: LoadVar(00002)
00033: LoadVar(00001)
00034: LoadVar(00000)
00035: Try
00036: ApplyArgToFn
00037: Unwind
00038: ApplyArgToFn
00039: ApplyArgToFn
00040:   Return
00041: LoadClosure { code: 00032, fvars: 00002 }
00042:   Return
00043: LoadClosure { code: 00041, fvars: 00001 }
00044:   Return
00045: LoadVar(00001)
00046: LoadVar(00002)
00047: ApplyFnToArg
00048:   Return
00049: LoadVar(00000)
00050:   Return
00051: LoadFn(00049)
00052:   Return
00053: LoadVar(00000)
00054:   Return
00055: LoadFn(00053)
00056:   Return
00057: LoadVar(00003)
00058: LoadVar(00002)
00059: LoadVar(00001)
00060: LoadVar(00000)
00061: Cmp
00062: ApplyFnToArg
00063:   Return
00064: LoadClosure { code: 00057, fvars: 00003 }
00065:   Return
00066: LoadClosure { code: 00064, fvars: 00002 }
00067:   Return
00068: LoadClosure { code: 00066, fvars: 00001 }
00069:   Return
00070: LoadVar(00005)
00071: PushString("False")
00072: ApplyFnToArg
00073: LoadVar(00002)
00074: ApplyFnToArg
00075:   Return
00076: LoadVar(00005)
00077: PushString("True")
00078: ApplyFnToArg
00079: LoadVar(00002)
00080: ApplyFnToArg
00081:   Return
00082: LoadFn(00068)
00083: LoadVar(00003)
00084: ApplyFnToArg
00085: PushString("True")
00086: ApplyFnToArg
00087: LoadClosure { code: 00070, fvars: 00005 }
00088: ApplyFnToArg
00089: LoadClosure { code: 00076, fvars: 00005 }
00090: ApplyFnToArg
00091:   Return
00092: LoadFn(00055)
00093: PushString("""")
00094: ApplyFnToArg
00095: LoadClosure { code: 00082, fvars: 00004 }
00096: ApplyFnToArg
00097:   Return
00098: LoadFn(00043)
00099: LoadClosure { code: 00045, fvars: 00002 }
00100: ApplyFnToArg
00101: PushEffect("toggle")
00102: ApplyFnToArg
00103: LoadFn(00051)
00104: PushString(""r"")
00105: ApplyFnToArg
00106: LoadClosure { code: 00092, fvars: 00003 }
00107: ApplyFnToArg
00108: ApplyFnToArg
00109:   Return
00110: LoadFn(00030)
00111: PushString(""r"")
00112: ApplyFnToArg
00113: LoadClosure { code: 00098, fvars: 00002 }
00114: ApplyFnToArg
00115:   Return
00116: LoadFn(00026)
00117: PushString(""val"")
00118: ApplyFnToArg
00119: LoadClosure { code: 00110, fvars: 00001 }
00120: ApplyFnToArg
00121:   Return
00122: PushString("List")
00123: PushEffect("toggle")
00124: PushString("")
00125: ApplyFnToArg
00126: ApplyFnToArg
00127: PushEffect("toggle")
00128: PushString("")
00129: ApplyFnToArg
00130: ApplyFnToArg
00131: PushEffect("toggle")
00132: PushString("")
00133: ApplyFnToArg
00134: ApplyFnToArg
00135:   Return
00136: LoadVar(00000)
00137: PushString("Value")
00138: PushString("False")
00139: ApplyFnToArg
00140: ApplyFnToArg
00141: LoadFn(00122)
00142: ApplyFnToArg
00143:   Return
00144: LoadFn(00016)
00145: PushString(""with-toggle"")
00146: ApplyFnToArg
00147: LoadFn(00022)
00148: PushString(""loop"")
00149: ApplyFnToArg
00150: LoadFn(00116)
00151: ApplyFnToArg
00152: ApplyFnToArg
00153: LoadFn(00136)
00154: ApplyFnToArg

List(True, False, True)