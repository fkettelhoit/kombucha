('acc => {
    try({
        effect!(Foo)
    }, effect!, 'r => { 'x => {
        r(acc(x))
    } })
})(List)

((=>
  'acc
  { (try
      { (effect!
          Foo) }
      effect!
      (=>
        'r
        { (=>
            'x
            { (r
                (acc
                  x)) }) })) })
  List)

( ( ( =>
        =>
          0
      "acc" )
    =>
      ( ( ( =>
              =>
                =>
                  ( try
                    2
                    1
                    0 )
            =>
              ( effect!
                "Foo" ) )
          effect! )
        ( ( =>
              =>
                0
            "r" )
          =>
            ( ( =>
                  =>
                    0
                "x" )
              =>
                ( 1
                  ( 2
                    0 ) ) ) ) ) )
  "List" )

00000: PushVar(00000)
00001:   Return
00002: PushFn(00000, 00000)
00003:   Return
00004: PushVar(00000)
00005: Apply
00006: Apply
00007:   Return
00008: PushVar(00002)
00009: PushVar(00001)
00010: PushFn(00004, 00000)
00011: Swap(00003)
00012: Try
00013: Apply
00014: Unwind
00015:   Return
00016: PushFn(00008, 00002)
00017:   Return
00018: PushFn(00016, 00001)
00019:   Return
00020: PushEffect("effect")
00021: PushString("Foo")
00022: Swap(00002)
00023: Apply
00024:   Return
00025: PushVar(00000)
00026:   Return
00027: PushFn(00025, 00000)
00028:   Return
00029: PushVar(00000)
00030:   Return
00031: PushFn(00029, 00000)
00032:   Return
00033: PushVar(00001)
00034: PushVar(00002)
00035: PushVar(00000)
00036: Swap(00002)
00037: Apply
00038: Swap(00002)
00039: Apply
00040:   Return
00041: PushFn(00031, 00000)
00042: PushString("x")
00043: Swap(00002)
00044: Apply
00045: PushFn(00033, 00002)
00046: Swap(00002)
00047: Apply
00048:   Return
00049: PushFn(00018, 00000)
00050: PushFn(00020, 00000)
00051: Swap(00002)
00052: Apply
00053: PushEffect("effect")
00054: Swap(00002)
00055: Apply
00056: PushFn(00027, 00000)
00057: PushString("r")
00058: Swap(00002)
00059: Apply
00060: PushFn(00041, 00001)
00061: Swap(00002)
00062: Apply
00063: Swap(00002)
00064: Apply
00065:   Return
00066: PushFn(00002, 00000)
00067: PushString("acc")
00068: Swap(00002)
00069: Apply
00070: PushFn(00049, 00000)
00071: Swap(00002)
00072: Apply
00073: PushString("List")
00074: Swap(00002)
00075: Apply

List(Foo)

---

'with-toggle = ('loop ~> {
    'val => { 'r => {
        try({
            r(val)
        }, toggle!, 'r => { ' => {
            if(val, True, {
              loop(False, r)
            }, {
              loop(True, r)
            })
        }})
    }}
})
with-toggle(False, { List(toggle!(), toggle!(), toggle!()) })

(=
  'with-toggle
  (~>
    'loop
    { (=>
        'val
        { (=>
            'r
            { (try
                { (r
                    val) }
                toggle!
                (=>
                  'r
                  { (=>
                      '
                      { (if
                          val
                          True
                          { (loop
                              False
                              r) }
                          { (loop
                              True
                              r) }) }) })) }) }) }))
(with-toggle
  False
  { (List
      (toggle!)
      (toggle!)
      (toggle!)) })

( ( ( =>
        =>
          =>
            ( 0
              1 )
      "with-toggle" )
    ( ( =>
          =>
            ~>
              0
        "loop" )
      =>
        ( ( =>
              =>
                0
            "val" )
          =>
            ( ( =>
                  =>
                    0
                "r" )
              =>
                ( ( ( =>
                        =>
                          =>
                            ( try
                              2
                              1
                              0 )
                      =>
                        ( 1
                          2 ) )
                    toggle! )
                  ( ( =>
                        =>
                          0
                      "r" )
                    =>
                      ( ( =>
                            =>
                              0
                          "" )
                        =>
                          ( ( ( ( =>
                                    =>
                                      =>
                                        =>
                                          ( if
                                            3
                                            2
                                            1
                                            0 )
                                  3 )
                                "True" )
                              =>
                                ( ( 5
                                    "False" )
                                  2 ) )
                            =>
                              ( ( 5
                                  "True" )
                                2 ) ) ) ) ) ) ) ) )
  =>
    ( ( 0
        ( "Value"
          "False" ) )
      =>
        ( ( ( "List"
              ( toggle!
                "Nil" ) )
            ( toggle!
              "Nil" ) )
          ( toggle!
            "Nil" ) ) ) )

00000: PushVar(00000)
00001: PushVar(00001)
00002: Swap(00002)
00003: Apply
00004:   Return
00005: PushFn(00000, 00001)
00006:   Return
00007: PushFn(00005, 00000)
00008:   Return
00009: PushVar(00000)
00010: Rec
00011:   Return
00012: PushFn(00009, 00000)
00013:   Return
00014: PushVar(00000)
00015:   Return
00016: PushFn(00014, 00000)
00017:   Return
00018: PushVar(00000)
00019:   Return
00020: PushFn(00018, 00000)
00021:   Return
00022: PushVar(00000)
00023: Apply
00024: Apply
00025:   Return
00026: PushVar(00002)
00027: PushVar(00001)
00028: PushFn(00022, 00000)
00029: Swap(00003)
00030: Try
00031: Apply
00032: Unwind
00033:   Return
00034: PushFn(00026, 00002)
00035:   Return
00036: PushFn(00034, 00001)
00037:   Return
00038: PushVar(00001)
00039: PushVar(00002)
00040: Swap(00002)
00041: Apply
00042:   Return
00043: PushVar(00000)
00044:   Return
00045: PushFn(00043, 00000)
00046:   Return
00047: PushVar(00000)
00048:   Return
00049: PushFn(00047, 00000)
00050:   Return
00051: PushVar(00003)
00052: PushVar(00002)
00053: PushVar(00001)
00054: PushVar(00000)
00055: Swap(00004)
00056: If
00057: Apply
00058:   Return
00059: PushFn(00051, 00003)
00060:   Return
00061: PushFn(00059, 00002)
00062:   Return
00063: PushFn(00061, 00001)
00064:   Return
00065: PushVar(00005)
00066: PushString("False")
00067: Swap(00002)
00068: Apply
00069: PushVar(00002)
00070: Swap(00002)
00071: Apply
00072:   Return
00073: PushVar(00005)
00074: PushString("True")
00075: Swap(00002)
00076: Apply
00077: PushVar(00002)
00078: Swap(00002)
00079: Apply
00080:   Return
00081: PushFn(00063, 00000)
00082: PushVar(00003)
00083: Swap(00002)
00084: Apply
00085: PushString("True")
00086: Swap(00002)
00087: Apply
00088: PushFn(00065, 00005)
00089: Swap(00002)
00090: Apply
00091: PushFn(00073, 00005)
00092: Swap(00002)
00093: Apply
00094:   Return
00095: PushFn(00049, 00000)
00096: PushString("")
00097: Swap(00002)
00098: Apply
00099: PushFn(00081, 00004)
00100: Swap(00002)
00101: Apply
00102:   Return
00103: PushFn(00036, 00000)
00104: PushFn(00038, 00002)
00105: Swap(00002)
00106: Apply
00107: PushEffect("toggle")
00108: Swap(00002)
00109: Apply
00110: PushFn(00045, 00000)
00111: PushString("r")
00112: Swap(00002)
00113: Apply
00114: PushFn(00095, 00003)
00115: Swap(00002)
00116: Apply
00117: Swap(00002)
00118: Apply
00119:   Return
00120: PushFn(00020, 00000)
00121: PushString("r")
00122: Swap(00002)
00123: Apply
00124: PushFn(00103, 00002)
00125: Swap(00002)
00126: Apply
00127:   Return
00128: PushFn(00016, 00000)
00129: PushString("val")
00130: Swap(00002)
00131: Apply
00132: PushFn(00120, 00001)
00133: Swap(00002)
00134: Apply
00135:   Return
00136: PushString("List")
00137: PushEffect("toggle")
00138: PushString("Nil")
00139: Swap(00002)
00140: Apply
00141: Swap(00002)
00142: Apply
00143: PushEffect("toggle")
00144: PushString("Nil")
00145: Swap(00002)
00146: Apply
00147: Swap(00002)
00148: Apply
00149: PushEffect("toggle")
00150: PushString("Nil")
00151: Swap(00002)
00152: Apply
00153: Swap(00002)
00154: Apply
00155:   Return
00156: PushVar(00000)
00157: PushString("Value")
00158: PushString("False")
00159: Swap(00002)
00160: Apply
00161: Swap(00002)
00162: Apply
00163: PushFn(00136, 00000)
00164: Swap(00002)
00165: Apply
00166:   Return
00167: PushFn(00007, 00000)
00168: PushString("with-toggle")
00169: Swap(00002)
00170: Apply
00171: PushFn(00012, 00000)
00172: PushString("loop")
00173: Swap(00002)
00174: Apply
00175: PushFn(00128, 00000)
00176: Swap(00002)
00177: Apply
00178: Swap(00002)
00179: Apply
00180: PushFn(00156, 00000)
00181: Swap(00002)
00182: Apply

List(True, False, True)